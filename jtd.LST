C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE JTD
OBJECT MODULE PLACED IN jtd.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE jtd.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg51.h> //Í·ÎÄ¼ş
   2          #define uchar unsigned char
   3          #define uint unsigned int //ºê¶¨Òå
   4          
   5          uchar data buf[4];      //ÃëÏÔÊ¾µÄ±äÁ¿
   6          uchar data sec_dx = 20;   //¶«Î÷ÊıÄ¬ÈÏ
   7          uchar data sec_nb = 30;   //ÄÏ±±Ä¬ÈÏÖµ
   8          uchar data set_timedx = 20; //ÉèÖÃ¶«Î÷·½ÏòµÄÊ±¼ä
   9          uchar data set_timenb = 30; //ÉèÖÃÄÏ±±·½ÏòµÄÊ±¼ä
  10          
  11          uchar data num_che_dx = 0; //ÉèÖÃ±äÁ¿ÓÃÓÚ¼ÇÂ¼¶«Î÷Í¨ĞĞ³µÁ¿µÄ¸öÊı
  12          uchar data num_che_nb = 0; //ÉèÖÃ±äÁ¿ÓÃÓÚ¼ÇÂ¼ÄÏ±±Í¨ĞĞ³µÁ¾µÄ¸öÊı
  13          
  14          uchar data xianshi_fx = 0; //ÏÔÊ¾·½Ê½
  15          int n;
  16          uchar data countt0, countt1; //¶¨Ê±Æ÷0ÖĞ¶Ï´ÎÊı
  17          //¶¨Òå6×é¿ª¹Ø
  18          sbit k1 = P1 ^ 5; //Ò¹¼äÄ£Ê½
  19          sbit k2 = P1 ^ 4; //½ûÖ¹
  20          sbit k3 = P3 ^ 4; //È·ÈÏ
  21          sbit k4 = P1 ^ 6; //¶«Î÷Í¨ĞĞ
  22          sbit k5 = P1 ^ 7; //ÄÏ±±Í¨ĞĞ
  23          sbit hw_dx = P3 ^ 5; //Ê¹ÓÃ´ËÒı½Å½ÓºìÍâÌ½Í·¼ì²â"¶«Î÷"·½ÏòÍ¨¹ıµÄ³µÁ¾µ±¼ì²âµ½ÄÏ±±ÓĞ³µÁ¾Í¨ĞĞÊ±£¬¸ÃÒı½Å»á³ÊÏÖµ
             -ÍµçÆ½
  24          sbit hw_nb = P3 ^ 6; //Ê¹ÓÃ´ËÒı½Å½ÓºìÍâÌ½Í·¼ì²â"ÄÏ±±"·½ÏòÍ¨¹ıµÄ³µÁ¾µ±¼ì²âµ½ÄÏ±±ÓĞ³µÁ¾Í¨ĞĞÊ±£¬¸ÃÒı½Å»á³ÊÏÖµ
             -ÍµçÆ½
  25          sbit k6 = P3 ^ 7; //ÇĞ»»·½Ïò
  26          
  27          sbit Red_nb = P2 ^ 6; //ÄÏ±±ºìµÆ±êÖ¾
  28          sbit Yellow_nb = P2 ^ 5; //ÄÏ±±»ÆµÆ±êÖ¾
  29          sbit Green_nb = P2 ^ 4;  //ÄÏ±±ÂÌµÆ±êÖ¾
  30          
  31          sbit Red_dx = P2 ^ 3; //¶«Î÷ºìµÆ±êÖ¾
  32          sbit Yellow_dx = P2 ^ 2; //¶«Î÷»ÆµÆ±êÖ¾
  33          sbit Green_dx = P2 ^ 1;  //¶«Î÷ÂÌµÆ±êÖ¾
  34          
  35          sbit Buzz = P3 ^ 3;
  36          bit set = 0;   //µ÷Ê±·½ÏòÇĞ»»¼ü±êÖ¾ =1Ê±£¬ÄÏ±±£¬=0Ê±£¬¶«Î÷
  37          bit dx_nb = 0;   //¶«Î÷ÄÏ±±¿ØÖÆÎ»
  38          bit shanruo = 0; //ÉÁË¸±êÖ¾Î»
  39          bit yejian = 0;  //Ò¹¼ä»ÆµÆÉÁË¸±êÖ¾Î»
  40          
  41          uchar code table[11] = {
  42            //¹²Òõ¼«×ÖĞÍÂë
  43            0x3f, //--0
  44            0x06, //--1
  45            0x5b, //--2
  46            0x4f, //--3
  47            0x66, //--4
  48            0x6d, //--5
  49            0x7d, //--6
  50            0x07, //--7
  51            0x7f, //--8
  52            0x6f, //--9
  53            0x00  //--NULL
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 2   

  54          };
  55          
  56          //º¯ÊıµÄÉùÃ÷²¿·Ö
  57          void delay(int ms); //ÑÓÊ±×Ó³ÌĞò
  58          void key();     //°´¼üÉ¨Ãè×Ó³ÌĞò
  59          void key_to1();   //¼ü´¦Àí×Ó³ÌĞò
  60          void key_to2();
  61          void key_to3();
  62          void key_to4();
  63          void key_to5();
  64          void display(); //ÏÔÊ¾×Ó³ÌĞò
  65          void logo();  //¿ª»úLOGO
  66          void Buzzer();
  67          //Ö÷³ÌĞò
  68          void main()
  69          {
  70   1        TMOD = 0X11; //¶¨Ê±Æ÷ÉèÖÃ
  71   1        TH1 = 0X3C;
  72   1        TL1 = 0XB0;
  73   1        TH0 = 0X3C; //¶¨Ê±Æ÷0ÖÃ³õÖµ 0.05S
  74   1        TL0 = 0XB0;
  75   1        SCON = 0X50;     //ÉèÖÃÎª¹¤×÷·½Ê½1,8Î»Êı¾İ£¬¿É±ä²¨ÌØÂÊ
  76   1        PCON = 0X00;     //²¨ÌØÂÊ²»¼Ó±¶
  77   1        ES = 1;        //¿ª´®¿ÚÖĞ¶Ï
  78   1        EA = 1;        //¿ª×ÜÖĞ¶Ï
  79   1        ET0 = 1;       //¶¨Ê±Æ÷0ÖĞ¶Ï¿ªÆô
  80   1        ET1 = 1;       //¶¨Ê±Æ÷1ÖĞ¶Ï¿ªÆô
  81   1        TR0 = 1;       //Æô¶¯¶¨Ê±0
  82   1        TR1 = 0;       //¹Ø±Õ¶¨Ê±1
  83   1        EX0 = 1;       //¿ªÍâ²¿ÖĞ¶Ï0
  84   1        EX1 = 1;       //¿ªÍâ²¿ÖĞ¶Ï1
  85   1        logo();        //¿ª»ú³õÊ¼»¯
  86   1        P2 = 0Xc3;       // ¿ªÊ¼Ä¬ÈÏ×´Ì¬£¬¶«Î÷ÂÌµÆ£¬ÄÏ±±»ÆµÆ
  87   1        sec_nb = sec_dx + 5; //Ä¬ÈÏÄÏ±±Í¨ĞĞÊ±¼ä±È¶«Î÷¶à5Ãë
  88   1        while (1)      //Ö÷Ñ­»·
  89   1        {
  90   2          key();   //µ÷ÓÃ°´¼üÉ¨Ãè³ÌĞò
  91   2          display(); //µ÷ÓÃÏÔÊ¾³ÌĞò
  92   2        }
  93   1      }
  94          
  95          void key_to1() //Ò¹¼äÄ£Ê½ÉèÖÃº¯Êı
  96          {
  97   1        TR0 = 0; //¹Ø¶¨Ê±Æ÷
  98   1        P2 = 0x00;
  99   1        TR1 = 1;
 100   1        sec_dx = 00; //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 101   1        sec_nb = 00;
 102   1      }
 103          
 104          void key_to2() //½ûÖ¹Í¨ĞĞÄ£Ê½ÉèÖÃº¯Êı
 105          {
 106   1        TR0 = 0;   //¹Ø¶¨Ê±Æ÷
 107   1        P2 = 0x00; //ÃğÏÔÊ¾
 108   1        Red_dx = 1;
 109   1        Red_nb = 1; //È«²¿ÖÃºìµÆ
 110   1        TR1 = 0;
 111   1        sec_dx = 00; //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 112   1        sec_nb = 00;
 113   1      }
 114          
 115          void key_to3() //È·ÈÏÉèÖÃº¯Êı
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 3   

 116          {
 117   1        TR0 = 1;       //Æô¶¯¶¨Ê±Æ÷0
 118   1        xianshi_fx = 0;    //ÉèÖÃÖØĞÂÏÔÊ¾
 119   1        sec_nb = set_timenb; //´ÓÖĞ¶Ï»Ø¸´£¬ÈÔÏÔÊ¾ÉèÖÃ¹ıµÄÊıÖµ
 120   1        sec_dx = set_timedx; //ÏÔÊ¾ÉèÖÃ¹ıµÄÊ±¼ä
 121   1        TR1 = 0;       //¹Ø¶¨Ê±Æ÷1
 122   1        if (set == 0)    //Ê±¼äµ¹Ê±µ½0Ê±
 123   1        {
 124   2          P2 = 0X00;       //ÃğÏÔÊ¾
 125   2          Green_dx = 1;    //¶«Î÷ÂÌµÆÁÁ
 126   2          Red_nb = 1;      //ÄÏ±±ºìµÆÁÁ
 127   2          sec_nb = sec_dx + 5; //»Øµ½³õÖµ
 128   2        }
 129   1        else
 130   1        {
 131   2          P2 = 0x00; //ÄÏ±±ÂÌµÆ£¬¶«Î÷ºìµÆ
 132   2          Green_nb = 1;
 133   2          Red_dx = 1;
 134   2          sec_dx = sec_nb + 5;
 135   2        }
 136   1      }
 137          
 138          void key_to4() //¶«Î÷Í¨ĞĞÉèÖÃº¯Êı
 139          {
 140   1        TR0 = 0;    //¹Ø¶¨Ê±Æ÷0
 141   1        TR1 = 0;    //¹Ø¶¨Ê±Æ÷1
 142   1        P2 = 0x00;  //ÃğÏÔÊ¾
 143   1        Green_dx = 1; //¶«Î÷·½ÏòÖÃÂÌµÆ
 144   1        Red_nb = 1;   //ÄÏ±±·½ÏòÎªºìµÆ
 145   1        sec_dx = 00;  //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 146   1        sec_nb = 00;
 147   1      }
 148          
 149          void key_to5() //ÄÏ±±Í¨ĞĞÉèÖÃº¯Êı
 150          {
 151   1        TR0 = 0;    //¹Ø¶¨Ê±Æ÷0
 152   1        TR1 = 0;    //¹Ø¶¨Ê±Æ÷1
 153   1        P2 = 0x00;  //ÃğÏÔÊ¾
 154   1        Green_nb = 1; //ÖÃÄÏ±±·½ÏòÎªÂÌµÆ
 155   1        Red_dx = 1;   //¶«Î÷·½ÏòÎªºìµÆ
 156   1        sec_nb = 00;  //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 157   1        sec_dx = 00;
 158   1      }
 159          
 160          //º¯ÊıµÄ¶¨Òå²¿·Ö
 161          void key(void) //°´¼üÉ¨Ãè×Ó³ÌĞò
 162          {
 163   1        if (k1 != 1) //µ±K1£¨Ò¹¼äÄ£Ê½£©°´ÏÂ
 164   1        {
 165   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 166   2          if (k1 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 167   2          {
 168   3            key_to1(); //Ò¹¼äÄ£Ê½ÉèÖÃº¯Êı
 169   3            do
 170   3            {
 171   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 172   4            } while (k1 != 1); //µÈ´ı°´¼üÊÍ·Å
 173   3          }
 174   2        }
 175   1        if (k2 != 1) //µ±K2£¨½ûÖ¹£©¼ü°´ÏÂÊ±
 176   1        {
 177   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 4   

 178   2          if (k2 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 179   2          {
 180   3            key_to2(); //Í£Ö¹Í¨ĞĞÉèÖÃº¯Êı
 181   3            do
 182   3            {
 183   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 184   4            } while (k2 != 1); //µÈ´ı°´¼üÊÍ·Å
 185   3          }
 186   2        }
 187   1        if (k3 != 1) //µ±K3£¨È·ÈÏ£©¼ü°´ÏÂÊ±
 188   1        {
 189   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 190   2          if (k3 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 191   2          {
 192   3            key_to3();
 193   3            do
 194   3            {
 195   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 196   4            } while (k3 != 1); //µÈ´ı°´¼üÊÍ·Å
 197   3          }
 198   2        }
 199   1      
 200   1        if (k4 != 1) //µ±K4£¨¶«Î÷Í¨ĞĞ£©¼ü°´ÏÂÊ±
 201   1        {
 202   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 203   2          if (k4 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 204   2          {
 205   3            key_to4(); //¶«Î÷Í¨ĞĞº¯Êı
 206   3            do
 207   3            {
 208   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 209   4            } while (k4 != 1); //µÈ´ı°´¼üÊÍ·Å
 210   3          }
 211   2        }
 212   1      
 213   1        if (k5 != 1) //µ±K5£¨ÄÏ±±Í¨ĞĞ£©¼ü°´ÏÂÊ±
 214   1        {
 215   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 216   2          if (k5 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 217   2          {
 218   3            key_to4(); //ÄÏ±±Í¨ĞĞº¯Êı
 219   3            do
 220   3            {
 221   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 222   4            } while (k5 != 1); //µÈ´ı°´¼üÊÍ·Å
 223   3          }
 224   2        }
 225   1      
 226   1        if (hw_dx != 1) //¶«Î÷ºìÍâÌ½Í·
 227   1        {
 228   2          display();    //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶ºÍ°´¼ü¼ì²â·½·¨»ù±¾ÏàÍ¬
 229   2          if (hw_dx != 1) //Èç¹ûÈ·¶¨ÓĞ³µÁ¾¾­¹ı
 230   2          {
 231   3            if (dx_nb == 0) //¶«Î÷Í¨ĞĞµÄÊ±¼ä
 232   3            {
 233   4              num_che_dx++; //ÓÃÓÚ¼ÇÂ¼¶«Î÷ÂÌµÆÊ±¾­¹ıµÄ³µÁ¾Êı
 234   4            }
 235   3            else
 236   3            {
 237   4              Buzz = 0; //·äÃùÆ÷¿ª
 238   4            }
 239   3            while (hw_dx != 1)
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 5   

 240   3              ; //µÈ´ıÊÍ·Å
 241   3            {
 242   4              display(); //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 243   4            }
 244   3            Buzz = 1; //·äÃùÆ÷¹Ø
 245   3          }
 246   2        }
 247   1      
 248   1        if (hw_nb != 1) //ÄÏ±±ºìÍâÌ½Í·
 249   1        {
 250   2          display();    //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶ºÍ°´¼ü¼ì²â·½·¨»ù±¾ÏàÍ¬
 251   2          if (hw_nb != 1) //Èç¹ûÈ·¶¨ÓĞ³µÁ¾¾­¹ı
 252   2          {
 253   3            if (dx_nb == 1) //¶«Î÷Í¨ĞĞµÄÊ±¼ä
 254   3            {
 255   4              num_che_nb++; //ÓÃÓÚ¼ÇÂ¼ÄÏ±±ÂÌµÆÊ±¾­¹ıµÄ³µÁ¾Êı
 256   4            }
 257   3            else
 258   3            {
 259   4              Buzz = 0; //·äÃùÆ÷¿ª
 260   4            }
 261   3            while (hw_nb != 1)
 262   3              ; //µÈ´ıÊÍ·Å
 263   3            {
 264   4              display(); //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 265   4            }
 266   3            Buzz = 1; //·äÃùÆ÷¹Ø
 267   3          }
 268   2        }
 269   1        if (k6 != 1) //£¨²é¿´£©¼ü°´ÏÂ
 270   1        {
 271   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 272   2          if (k6 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 273   2          {
 274   3            xianshi_fx++;
 275   3            if (xianshi_fx >= 3)
 276   3              xianshi_fx = 2;
 277   3            while (k6 != 1)
 278   3              ; //µÈ´ı°´¼üÊÍ·Å
 279   3            {
 280   4              display(); //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 281   4            }
 282   3          }
 283   2        }
 284   1      }
 285          void display(void) //ÏÔÊ¾×Ó³ÌĞò
 286          {
 287   1      
 288   1        if (xianshi_fx == 0) //Õı³£ÏÔÊ¾
 289   1        {
 290   2          buf[1] = sec_nb / 10; //µÚ1Î» ¶«Î÷ÏÔÊ¾ÃëÊ®Î»
 291   2          buf[2] = sec_nb % 10; //µÚ2Î» ¶«Î÷ÏÔÊ¾Ãë¸öÎ»
 292   2          buf[3] = sec_dx / 10; //µÚ3Î» ÄÏ±±ÏÔÊ¾ÃëÊ®Î»
 293   2          buf[0] = sec_dx % 10; //µÚ4Î» ÄÏ±±ÏÔÊ¾Ãë¸öÎ»
 294   2        }
 295   1        if (xianshi_fx == 1) //²é¿´Í¨ĞĞÊ±¼ä
 296   1        {
 297   2          buf[1] = set_timenb / 10; //µÚ1Î» ¶«Î÷Í¨ĞĞÃëÊ®Î»
 298   2          buf[2] = set_timenb % 10; //µÚ2Î» ¶«Î÷Í¨ĞĞÃë¸öÎ»
 299   2          buf[3] = set_timedx / 10; //µÚ3Î» ÄÏ±±Í¨ĞĞÃëÊ®Î»
 300   2          buf[0] = set_timedx % 10; //µÚ4Î» ÄÏ±±Í¨ĞĞÃë¸öÎ»
 301   2        }
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 6   

 302   1      
 303   1        if (xianshi_fx == 2) //²é¿´ºìÍâ¼ÆÊıÖµ
 304   1        {
 305   2          buf[1] = num_che_nb / 10; //µÚ1Î» ¶«Î÷ºìÍâ¼ÆÊıÖµÊ®Î»
 306   2          buf[2] = num_che_nb % 10; //µÚ2Î» ¶«Î÷ºìÍâ¼ÆÊıÖµ¸öÎ»
 307   2          buf[3] = num_che_dx / 10; //µÚ3Î» ÄÏ±±ºìÍâ¼ÆÊıÖµÊ®Î»
 308   2          buf[0] = num_che_dx % 10; //µÚ4Î» ÄÏ±±ºìÍâ¼ÆÊıÖµ¸öÎ»
 309   2        }
 310   1      
 311   1        P1 = 0xff;      // ³õÊ¼µÆÎªÃğµÄ
 312   1        P0 = 0x00;      ////ÃğÏÔÊ¾
 313   1        P1 = 0xfe;      //Æ¬Ñ¡LED1
 314   1        P0 = table[buf[1]]; //ËÍ¶«Î÷Ê±¼äÊ®Î»µÄÊıÂë¹Ü±àÂë
 315   1        delay(1);     //ÑÓÊ±
 316   1        P1 = 0xff;      //¹ØÏÔÊ¾
 317   1        P0 = 0x00;      //ÃğÏÔÊ¾
 318   1      
 319   1        P1 = 0xfd;      //Æ¬Ñ¡LED2
 320   1        P0 = table[buf[2]]; //ËÍ¶«Î÷Ê±¼ä¸öÎ»µÄÊıÂë¹Ü±àÂë
 321   1        delay(1);     //ÑÓÊ±
 322   1        P1 = 0xff;      //¹ØÏÔÊ¾
 323   1        P0 = 0x00;      //¹ØÏÔÊ¾
 324   1        P1 = 0Xfb;      //Æ¬Ñ¡LED3
 325   1      
 326   1        P0 = table[buf[3]]; //ËÍÄÏ±±Ê±¼äÊ®Î»µÄÊıÂë¹Ü±àÂë
 327   1        delay(1);     //ÑÓÊ±
 328   1        P1 = 0xff;      //¹ØÏÔÊ¾
 329   1        P0 = 0x00;      //¹ØÏÔÊ¾
 330   1        P1 = 0Xf7;      //Æ¬Ñ¡LED4
 331   1        P0 = table[buf[0]]; //ËÍÄÏ±±Ê±¼ä¸öÎ»µÄÊıÂë¹Ü±àÂë
 332   1        delay(1);     //ÑÓÊ±
 333   1      }
 334          
 335          void time0(void) interrupt 1 using 1 //¶¨Ê±ÖĞ¶Ï×Ó³ÌĞò
 336          {
 337   1        TH0 = 0X3C;      //ÖØ¸³³õÖµ
 338   1        TL0 = 0XB0;      //12m¾§Õñ50ms//ÖØ¸³³õÖµ
 339   1        TR0 = 1;       //ÖØĞÂÆô¶¯¶¨Ê±Æ÷
 340   1        countt0++;       //Èí¼ş¼ÆÊı¼Ó1
 341   1        if (countt0 == 10) //¼Óµ½10Ò²¾ÍÊÇ°ëÃë
 342   1        {
 343   2          if ((sec_nb <= 5) && (dx_nb == 0) && (shanruo == 1)) //¶«Î÷»ÆµÆÉÁ
 344   2          {
 345   3            Green_dx = 0;
 346   3            Yellow_dx = 0;
 347   3            Buzz = 0; //·äÃùÆ÷¹Ø
 348   3          }
 349   2          if ((sec_dx <= 5) && (dx_nb == 1) && (shanruo == 1)) //ÄÏ±±»ÆµÆÉÁ
 350   2          {
 351   3            Green_nb = 0;
 352   3            Yellow_nb = 0;
 353   3            Buzz = 0; //·äÃùÆ÷¹Ø
 354   3          }
 355   2        }
 356   1      
 357   1        if (countt0 == 20) // ¶¨Ê±Æ÷ÖĞ¶Ï´ÎÊı=20Ê±£¨¼´1ÃëÊ±£©
 358   1        {
 359   2          countt0 = 0; //ÇåÁã¼ÆÊıÆ÷
 360   2          sec_dx--; //¶«Î÷Ê±¼ä¼õ1
 361   2          sec_nb--; //ÄÏ±±Ê±¼ä¼õ1
 362   2      
 363   2          if ((sec_nb <= 5) && (dx_nb == 0) && (shanruo == 1)) //¶«Î÷»ÆµÆÉÁ
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 7   

 364   2          {
 365   3            Green_dx = 0;
 366   3            Yellow_dx = 1;
 367   3            Buzz = 1; //·äÃùÆ÷¹Ø
 368   3          }
 369   2          if ((sec_dx <= 5) && (dx_nb == 1) && (shanruo == 1)) //ÄÏ±±»ÆµÆÉÁ
 370   2          {
 371   3            Green_nb = 0;
 372   3            Yellow_nb = 1;
 373   3            Buzz = 1; //·äÃùÆ÷¹Ø
 374   3          }
 375   2          if (sec_dx == 0 && sec_nb == 5) //µ±¶«Î÷µ¹¼ÆÊ±µ½0Ê±£¬ÖØÖÃ5Ãë£¬ÓÃÓÚ»ÆµÆÉÁË¸Ê±¼ä
 376   2          {
 377   3            sec_dx = 5;
 378   3            shanruo = 1;
 379   3          }
 380   2          if (sec_nb == 0 && sec_dx == 5) //µ±ÄÏ±±µ¹¼ÆÊ±µ½0Ê±£¬ÖØÖÃ5Ãë£¬ÓÃÓÚ»ÆµÆÉÁË¸Ê±¼ä
 381   2          {
 382   3            sec_nb = 5;
 383   3            shanruo = 1;
 384   3          }
 385   2          if (dx_nb == 0 && sec_nb == 0) //µ±»ÆµÆÉÁË¸Ê±¼äµ¹¼ÆÊ±µ½0Ê±£¬
 386   2          {
 387   3            Buzz = 1;  //·äÃùÆ÷¿ª
 388   3            P2 = 0x00; //ÖØÖÃ¶«Î÷ÄÏ±³·½ÏòµÄºìÂÌµÆ
 389   3            Green_nb = 1;
 390   3            Red_dx = 1;
 391   3            dx_nb = !dx_nb;
 392   3            shanruo = 0;
 393   3            if (num_che_nb > set_timenb / 2) //Èç¹û´ËÊ±ÄÏ±±Í¨ĞĞµÄ³µÁ¾Êı´óÓÚÔ¤ÉèÍ¨ĞĞÁ¿
 394   3              set_timenb = set_timenb + 5;
 395   3            if (num_che_nb == 0) //Èç¹ûÄÏ±±·½ÏòÎŞ³µÁ¾Í¨ĞĞ,Ã¿´Îµİ¼õ5Ãë
 396   3              set_timenb = set_timenb - 5;
 397   3            if (set_timenb <= 15)
 398   3              set_timenb = 15;
 399   3            sec_nb = set_timenb;   //ÖØ¸³ÄÏ±±·½ÏòµÄÆğÊ¼Öµ
 400   3            sec_dx = set_timenb + 5; //ÖØ¸³¶«Î÷·½ÏòµÄÆğÊ¼Öµ
 401   3            num_che_nb = 0;      //ÇåÁã
 402   3          }
 403   2      
 404   2          if (dx_nb == 1 && sec_dx == 0) //µ±»ÆµÆÉÁË¸Ê±¼äµ½
 405   2          {
 406   3            P2 = 0X00;             //ÖØÖÃ¶«Î÷ÄÏ±±µÄºìÂÌµÆ×´Ì¬
 407   3            Green_dx = 1;          //¶«Î÷ÂÌµÆÁÁ
 408   3            Red_nb = 1;            //ÄÏ±±ºìµÆÁÁ
 409   3            dx_nb = !dx_nb;          //È¡·´
 410   3            shanruo = 0;           //ÉÁË¸
 411   3            if (num_che_dx > set_timedx / 2) //Èç¹û´ËÊ±ÄÏ±±Í¨ĞĞµÄ³µÁ¾Êı´óÓÚÔ¤ÉèÍ¨ĞĞÁ¿
 412   3              set_timedx = set_timedx + 5;
 413   3            if (num_che_dx == 0) //Èç¹û¶«Î÷·½ÏòÎŞ³µÁ¾Í¨ĞĞ,Ã¿´Îµİ¼õ5Ãë
 414   3              set_timedx = set_timedx - 5;
 415   3            if (set_timedx <= 15)
 416   3              set_timedx = 15;
 417   3            sec_dx = set_timedx;   //ÖØ¸³¶«Î÷·½ÏòµÄÆğÊ¼Öµ
 418   3            sec_nb = set_timedx + 5; //ÖØ¸³ÄÏ±±·½ÏòµÄÆğÊ¼Öµ
 419   3            num_che_dx = 0;      //ÇåÁã
 420   3          }
 421   2        }
 422   1      }
 423          void time1(void) interrupt 3 //¶¨Ê±ÖĞ¶Ï×Ó³ÌĞò
 424          {
 425   1        TH1 = 0X3C;      //ÖØ¸³³õÖµ
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 8   

 426   1        TL1 = 0XB0;      //12m¾§Õñ50ms//ÖØ¸³³õÖµ
 427   1        countt1++;       //Èí¼ş¼ÆÊı¼Ó1
 428   1        if (countt1 == 10) // ¶¨Ê±Æ÷ÖĞ¶Ï´ÎÊı=10Ê±£¨¼´0.5Ãë£©
 429   1        {
 430   2          Yellow_nb = 0; //ÄÏ±±»ÆµÆÃğ
 431   2          Yellow_dx = 0; //¶«Î÷»ÆµÆÃğ
 432   2        }
 433   1        if (countt1 == 20) // ¶¨Ê±Æ÷ÖĞ¶Ï´ÎÊı=20Ê±£¨¼´1ÃëÊ±£©
 434   1        {
 435   2          countt1 = 0;   //ÇåÁã¼ÆÊıÆ÷
 436   2          Yellow_nb = 1; //ÄÏ±±»ÆµÆÁÁ
 437   2          Yellow_dx = 1; //¶«Î÷»ÆµÆÁÁ
 438   2        }
 439   1      }
 440          
 441          //Íâ²¿ÖĞ¶Ï0
 442          void int0(void) interrupt 0 using 1 
 443          {
 444   1      }
 445          
 446          //Íâ²¿ÖĞ¶Ï1
 447          void int1(void) interrupt 2 using 1 
 448          {
 449   1      }
 450          
 451          void Com_Int(void) interrupt 4    //´®¿ÚÖĞ¶Ï×Óº¯Êı
 452          {
 453   1        uchar i;
 454   1        uchar receive_data, *ruturn_data[8];
 455   1      
 456   1        EA = 0;
 457   1      
 458   1        if (RI == 1)      //µ±Ó²¼ş½ÓÊÕµ½Ò»¸öÊı¾İÊ±£¬RI»áÖÃÎ»
 459   1        {
 460   2          RI = 0;
 461   2          receive_data = SBUF;     //½ÓÊÕµ½µÄÊı¾İ
 462   2      
 463   2          if (receive_data == '1')    //Ò¹¼äÄ£Ê½
 464   2          {
 465   3            key_to1();
 466   3            display();
 467   3            ruturn_data[8] = "ok-1";
 468   3          }
 469   2          else if (receive_data == '2')   //Í£Ö¹Ä£Ê½
 470   2          {
 471   3            key_to2();
 472   3            display();
 473   3            ruturn_data[8] = "ok-2";
 474   3          }
 475   2          else if (receive_data == '3')   //È·ÈÏ£¨ÖØÏÖ£©Ä£Ê½
 476   2          {
 477   3            key_to3();
 478   3            display();
 479   3            ruturn_data[8] = "ok-3";
 480   3          }
 481   2          else if (receive_data == '4')   //¶«Î÷Í¨ĞĞÄ£Ê½
 482   2          {
 483   3            key_to4();
 484   3            display();
 485   3            ruturn_data[8] = "ok-4";
 486   3          }
 487   2          else if (receive_data == '5')   //ÄÏ±±Í¨ĞĞÄ£Ê½
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:03:28 PAGE 9   

 488   2          {
 489   3            key_to5();
 490   3            display();
 491   3            ruturn_data[8] = "ok-5";
 492   3          }
 493   2          else
 494   2          {
 495   3            ruturn_data[8] = "error";
 496   3          }
 497   2        }
 498   1        for (i = 0; i < 8; i++)
 499   1        {
 500   2          SBUF = *ruturn_data[i]; //½«Òª·¢ËÍµÄÊı¾İ·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 501   2          while (!TI)
 502   2            ;   //µÈ´ı·¢ËÍÊı¾İÍê³É
 503   2          TI = 0; //Çå³ı·¢ËÍÍê³É±êÖ¾Î»
 504   2        }
 505   1        EA = 1;
 506   1      }
 507          void logo() //¿ª»úµÄLogo  "- - - -"
 508          {
 509   1        for (n = 0; n < 50; n++) //Ñ­»·ÏÔÊ¾----50´Î
 510   1        {
 511   2          P0 = 0x40; //ËÍĞÎ¡°-¡±
 512   2          P1 = 0xfe; //µÚÒ»Î»ÏÔÊ¾
 513   2          delay(1);  //ÑÓÊ±
 514   2          P1 = 0xfd; //µÚ¶şÎ»ÏÔÊ¾
 515   2          delay(1);  //ÑÓÊ±
 516   2          P1 = 0Xfb; //µÚÈıÎ»ÏÔÊ¾
 517   2          delay(1);  //ÑÓÊ±
 518   2          P1 = 0Xf7; //µÚËÄÎ»ÏÔÊ¾
 519   2          delay(1);  //ÑÓÊ±
 520   2          P1 = 0xff; //ÃğÏÔÊ¾
 521   2        }
 522   1      }
 523          
 524          void delay(int ms) //ÑÓÊ±×Ó³ÌĞò
 525          {
 526   1        uint j, k;
 527   1        for (j = 0; j < ms; j++) //ÑÓÊ±ms
 528   1          for (k = 0; k < 124; k++)
 529   1            ; //´óÔ¼1ºÁÃëµÄÑÓÊ±
 530   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1149    ----
   CONSTANT SIZE    =     42    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15      25
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

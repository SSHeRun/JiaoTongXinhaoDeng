C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE JTD
OBJECT MODULE PLACED IN jtd.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE jtd.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <reg52.h> //Í·ÎÄ¼ş
   2          #define uchar unsigned char
   3          #define uint unsigned int //ºê¶¨Òå
   4          sfr T2MOD = 0xC9;
   5          
   6          uchar data buf[4];      //ÃëÏÔÊ¾µÄ±äÁ¿
   7          uchar data sec_dx = 20;   //¶«Î÷ÊıÄ¬ÈÏ
   8          uchar data sec_nb = 30;   //ÄÏ±±Ä¬ÈÏÖµ
   9          uchar data set_timedx = 20; //ÉèÖÃ¶«Î÷·½ÏòµÄÊ±¼ä
  10          uchar data set_timenb = 30; //ÉèÖÃÄÏ±±·½ÏòµÄÊ±¼ä
  11          
  12          uchar data num_che_dx = 0; //ÉèÖÃ±äÁ¿ÓÃÓÚ¼ÇÂ¼¶«Î÷Í¨ĞĞ³µÁ¿µÄ¸öÊı
  13          uchar data num_che_nb = 0; //ÉèÖÃ±äÁ¿ÓÃÓÚ¼ÇÂ¼ÄÏ±±Í¨ĞĞ³µÁ¾µÄ¸öÊı
  14          
  15          uchar data xianshi_fx = 0; //ÏÔÊ¾·½Ê½
  16          int n;
  17          uchar data countt0, countt1; //¶¨Ê±Æ÷0ÖĞ¶Ï´ÎÊı
  18          //¶¨Òå6×é¿ª¹Ø
  19          sbit k1 = P1 ^ 5; //Ò¹¼äÄ£Ê½
  20          sbit k2 = P1 ^ 4; //½ûÖ¹
  21          sbit k3 = P3 ^ 4; //È·ÈÏ
  22          sbit k4 = P1 ^ 6; //¶«Î÷Í¨ĞĞ
  23          sbit k5 = P1 ^ 7; //ÄÏ±±Í¨ĞĞ
  24          sbit hw_dx = P3 ^ 5; //Ê¹ÓÃ´ËÒı½Å½ÓºìÍâÌ½Í·¼ì²â"¶«Î÷"·½ÏòÍ¨¹ıµÄ³µÁ¾µ±¼ì²âµ½ÄÏ±±ÓĞ³µÁ¾Í¨ĞĞÊ±£¬¸ÃÒı½Å»á³ÊÏÖµ
             -ÍµçÆ½
  25          sbit hw_nb = P3 ^ 6; //Ê¹ÓÃ´ËÒı½Å½ÓºìÍâÌ½Í·¼ì²â"ÄÏ±±"·½ÏòÍ¨¹ıµÄ³µÁ¾µ±¼ì²âµ½ÄÏ±±ÓĞ³µÁ¾Í¨ĞĞÊ±£¬¸ÃÒı½Å»á³ÊÏÖµ
             -ÍµçÆ½
  26          sbit k6 = P3 ^ 7; //ÇĞ»»·½Ïò
  27          
  28          sbit Red_nb = P2 ^ 6; //ÄÏ±±ºìµÆ±êÖ¾
  29          sbit Yellow_nb = P2 ^ 5; //ÄÏ±±»ÆµÆ±êÖ¾
  30          sbit Green_nb = P2 ^ 4;  //ÄÏ±±ÂÌµÆ±êÖ¾
  31          
  32          sbit Red_dx = P2 ^ 3; //¶«Î÷ºìµÆ±êÖ¾
  33          sbit Yellow_dx = P2 ^ 2; //¶«Î÷»ÆµÆ±êÖ¾
  34          sbit Green_dx = P2 ^ 1;  //¶«Î÷ÂÌµÆ±êÖ¾
  35          
  36          sbit Buzz = P3 ^ 3;
  37          bit set = 0;   //µ÷Ê±·½ÏòÇĞ»»¼ü±êÖ¾ =1Ê±£¬ÄÏ±±£¬=0Ê±£¬¶«Î÷
  38          bit dx_nb = 0;   //¶«Î÷ÄÏ±±¿ØÖÆÎ»
  39          bit shanruo = 0; //ÉÁË¸±êÖ¾Î»
  40          bit yejian = 0;  //Ò¹¼ä»ÆµÆÉÁË¸±êÖ¾Î»
  41          
  42          uchar code table[11] = {
  43            //¹²Òõ¼«×ÖĞÍÂë
  44            0x3f, //--0
  45            0x06, //--1
  46            0x5b, //--2
  47            0x4f, //--3
  48            0x66, //--4
  49            0x6d, //--5
  50            0x7d, //--6
  51            0x07, //--7
  52            0x7f, //--8
  53            0x6f, //--9
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 2   

  54            0x00  //--NULL
  55          };
  56          
  57          //º¯ÊıµÄÉùÃ÷²¿·Ö
  58          void delay(int ms); //ÑÓÊ±×Ó³ÌĞò
  59          void key();     //°´¼üÉ¨Ãè×Ó³ÌĞò
  60          void key_to1();   //¼ü´¦Àí×Ó³ÌĞò
  61          void key_to2();
  62          void key_to3();
  63          void key_to4();
  64          void key_to5();
  65          void display(); //ÏÔÊ¾×Ó³ÌĞò
  66          void logo();  //¿ª»úLOGO
  67          void Buzzer();
  68          //Ö÷³ÌĞò
  69          void main()
  70          {
  71   1        TMOD = 0X11; //¶¨Ê±Æ÷ÉèÖÃ
  72   1        TH1 = 0X3C;
  73   1        TL1 = 0XB0;
  74   1        TH0 = 0X3C; //¶¨Ê±Æ÷0ÖÃ³õÖµ 0.05S
  75   1        TL0 = 0XB0;
  76   1      
  77   1        T2MOD = 0x01; //×Ô¶¯ÖØÔØ
  78   1        T2CON = 0x30; //T2ÓÃ×ö·¢ËÍ½ÓÊÕÊ±ÖÓ
  79   1        TH2 = 0xFF;  //9600²¨ÌØÂÊ,11.0592Mhz¾§Õñ
  80   1        TL2 = 0xDC; 
  81   1        RCAP2H = 0xFF; 
  82   1        RCAP2L = 0xDC; 
  83   1        SCON = 0x50; //´®¿Ú·½Ê½1,1¸öÆğÊ¼Î»,1¸öÍ£Ö¹Î»,8Î»Êı¾İ£¬¿É±ä²¨ÌØÂÊ
  84   1        PCON = 0X00;     //²¨ÌØÂÊ²»¼Ó±¶
  85   1        TR2 = 1;  //Æô¶¯T2
  86   1      
  87   1        ES = 1;        //¿ª´®¿ÚÖĞ¶Ï
  88   1        EA = 1;        //¿ª×ÜÖĞ¶Ï
  89   1        ET0 = 1;       //¶¨Ê±Æ÷0ÖĞ¶Ï¿ªÆô
  90   1        ET1 = 1;       //¶¨Ê±Æ÷1ÖĞ¶Ï¿ªÆô
  91   1        TR0 = 1;       //Æô¶¯¶¨Ê±0
  92   1        TR1 = 0;       //¹Ø±Õ¶¨Ê±1
  93   1        EX0 = 1;       //¿ªÍâ²¿ÖĞ¶Ï0
  94   1        EX1 = 1;       //¿ªÍâ²¿ÖĞ¶Ï1
  95   1        logo();        //¿ª»ú³õÊ¼»¯
  96   1        P2 = 0Xc3;       // ¿ªÊ¼Ä¬ÈÏ×´Ì¬£¬¶«Î÷ÂÌµÆ£¬ÄÏ±±»ÆµÆ
  97   1        sec_nb = sec_dx + 5; //Ä¬ÈÏÄÏ±±Í¨ĞĞÊ±¼ä±È¶«Î÷¶à5Ãë
  98   1        while (1)      //Ö÷Ñ­»·
  99   1        {
 100   2          key();   //µ÷ÓÃ°´¼üÉ¨Ãè³ÌĞò
 101   2          display(); //µ÷ÓÃÏÔÊ¾³ÌĞò
 102   2        }
 103   1      }
 104          
 105          void key_to1() //Ò¹¼äÄ£Ê½ÉèÖÃº¯Êı
 106          {
 107   1        TR0 = 0; //¹Ø¶¨Ê±Æ÷
 108   1        P2 = 0x00;
 109   1        TR1 = 1;
 110   1        sec_dx = 00; //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 111   1        sec_nb = 00;
 112   1      }
 113          
 114          void key_to2() //½ûÖ¹Í¨ĞĞÄ£Ê½ÉèÖÃº¯Êı
 115          {
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 3   

 116   1        TR0 = 0;   //¹Ø¶¨Ê±Æ÷
 117   1        P2 = 0x00; //ÃğÏÔÊ¾
 118   1        Red_dx = 1;
 119   1        Red_nb = 1; //È«²¿ÖÃºìµÆ
 120   1        TR1 = 0;
 121   1        sec_dx = 00; //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 122   1        sec_nb = 00;
 123   1      }
 124          
 125          void key_to3() //È·ÈÏÉèÖÃº¯Êı
 126          {
 127   1        TR0 = 1;       //Æô¶¯¶¨Ê±Æ÷0
 128   1        xianshi_fx = 0;    //ÉèÖÃÖØĞÂÏÔÊ¾
 129   1        sec_nb = set_timenb; //´ÓÖĞ¶Ï»Ø¸´£¬ÈÔÏÔÊ¾ÉèÖÃ¹ıµÄÊıÖµ
 130   1        sec_dx = set_timedx; //ÏÔÊ¾ÉèÖÃ¹ıµÄÊ±¼ä
 131   1        TR1 = 0;       //¹Ø¶¨Ê±Æ÷1
 132   1        if (set == 0)    //Ê±¼äµ¹Ê±µ½0Ê±
 133   1        {
 134   2          P2 = 0X00;       //ÃğÏÔÊ¾
 135   2          Green_dx = 1;    //¶«Î÷ÂÌµÆÁÁ
 136   2          Red_nb = 1;      //ÄÏ±±ºìµÆÁÁ
 137   2          sec_nb = sec_dx + 5; //»Øµ½³õÖµ
 138   2        }
 139   1        else
 140   1        {
 141   2          P2 = 0x00; //ÄÏ±±ÂÌµÆ£¬¶«Î÷ºìµÆ
 142   2          Green_nb = 1;
 143   2          Red_dx = 1;
 144   2          sec_dx = sec_nb + 5;
 145   2        }
 146   1      }
 147          
 148          void key_to4() //¶«Î÷Í¨ĞĞÉèÖÃº¯Êı
 149          {
 150   1        TR0 = 0;    //¹Ø¶¨Ê±Æ÷0
 151   1        TR1 = 0;    //¹Ø¶¨Ê±Æ÷1
 152   1        P2 = 0x00;  //ÃğÏÔÊ¾
 153   1        Green_dx = 1; //¶«Î÷·½ÏòÖÃÂÌµÆ
 154   1        Red_nb = 1;   //ÄÏ±±·½ÏòÎªºìµÆ
 155   1        sec_dx = 00;  //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 156   1        sec_nb = 00;
 157   1      }
 158          
 159          void key_to5() //ÄÏ±±Í¨ĞĞÉèÖÃº¯Êı
 160          {
 161   1        TR0 = 0;    //¹Ø¶¨Ê±Æ÷0
 162   1        TR1 = 0;    //¹Ø¶¨Ê±Æ÷1
 163   1        P2 = 0x00;  //ÃğÏÔÊ¾
 164   1        Green_nb = 1; //ÖÃÄÏ±±·½ÏòÎªÂÌµÆ
 165   1        Red_dx = 1;   //¶«Î÷·½ÏòÎªºìµÆ
 166   1        sec_nb = 00;  //ËÄ¸ö·½ÏòµÄÊ±¼ä¶¼Îª00
 167   1        sec_dx = 00;
 168   1      }
 169          
 170          //º¯ÊıµÄ¶¨Òå²¿·Ö
 171          void key(void) //°´¼üÉ¨Ãè×Ó³ÌĞò
 172          {
 173   1        if (k1 != 1) //µ±K1£¨Ò¹¼äÄ£Ê½£©°´ÏÂ
 174   1        {
 175   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 176   2          if (k1 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 177   2          {
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 4   

 178   3            key_to1(); //Ò¹¼äÄ£Ê½ÉèÖÃº¯Êı
 179   3            do
 180   3            {
 181   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 182   4            } while (k1 != 1); //µÈ´ı°´¼üÊÍ·Å
 183   3          }
 184   2        }
 185   1        if (k2 != 1) //µ±K2£¨½ûÖ¹£©¼ü°´ÏÂÊ±
 186   1        {
 187   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 188   2          if (k2 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 189   2          {
 190   3            key_to2(); //Í£Ö¹Í¨ĞĞÉèÖÃº¯Êı
 191   3            do
 192   3            {
 193   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 194   4            } while (k2 != 1); //µÈ´ı°´¼üÊÍ·Å
 195   3          }
 196   2        }
 197   1        if (k3 != 1) //µ±K3£¨È·ÈÏ£©¼ü°´ÏÂÊ±
 198   1        {
 199   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 200   2          if (k3 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 201   2          {
 202   3            key_to3();
 203   3            do
 204   3            {
 205   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 206   4            } while (k3 != 1); //µÈ´ı°´¼üÊÍ·Å
 207   3          }
 208   2        }
 209   1      
 210   1        if (k4 != 1) //µ±K4£¨¶«Î÷Í¨ĞĞ£©¼ü°´ÏÂÊ±
 211   1        {
 212   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 213   2          if (k4 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 214   2          {
 215   3            key_to4(); //¶«Î÷Í¨ĞĞº¯Êı
 216   3            do
 217   3            {
 218   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 219   4            } while (k4 != 1); //µÈ´ı°´¼üÊÍ·Å
 220   3          }
 221   2        }
 222   1      
 223   1        if (k5 != 1) //µ±K5£¨ÄÏ±±Í¨ĞĞ£©¼ü°´ÏÂÊ±
 224   1        {
 225   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 226   2          if (k5 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 227   2          {
 228   3            key_to4(); //ÄÏ±±Í¨ĞĞº¯Êı
 229   3            do
 230   3            {
 231   4              display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 232   4            } while (k5 != 1); //µÈ´ı°´¼üÊÍ·Å
 233   3          }
 234   2        }
 235   1      
 236   1        if (hw_dx != 1) //¶«Î÷ºìÍâÌ½Í·
 237   1        {
 238   2          display();    //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶ºÍ°´¼ü¼ì²â·½·¨»ù±¾ÏàÍ¬
 239   2          if (hw_dx != 1) //Èç¹ûÈ·¶¨ÓĞ³µÁ¾¾­¹ı
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 5   

 240   2          {
 241   3            if (dx_nb == 0) //¶«Î÷Í¨ĞĞµÄÊ±¼ä
 242   3            {
 243   4              num_che_dx++; //ÓÃÓÚ¼ÇÂ¼¶«Î÷ÂÌµÆÊ±¾­¹ıµÄ³µÁ¾Êı
 244   4            }
 245   3            else
 246   3            {
 247   4              Buzz = 0; //·äÃùÆ÷¿ª
 248   4            }
 249   3            while (hw_dx != 1)
 250   3              ; //µÈ´ıÊÍ·Å
 251   3            {
 252   4              display(); //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 253   4            }
 254   3            Buzz = 1; //·äÃùÆ÷¹Ø
 255   3          }
 256   2        }
 257   1      
 258   1        if (hw_nb != 1) //ÄÏ±±ºìÍâÌ½Í·
 259   1        {
 260   2          display();    //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶ºÍ°´¼ü¼ì²â·½·¨»ù±¾ÏàÍ¬
 261   2          if (hw_nb != 1) //Èç¹ûÈ·¶¨ÓĞ³µÁ¾¾­¹ı
 262   2          {
 263   3            if (dx_nb == 1) //¶«Î÷Í¨ĞĞµÄÊ±¼ä
 264   3            {
 265   4              num_che_nb++; //ÓÃÓÚ¼ÇÂ¼ÄÏ±±ÂÌµÆÊ±¾­¹ıµÄ³µÁ¾Êı
 266   4            }
 267   3            else
 268   3            {
 269   4              Buzz = 0; //·äÃùÆ÷¿ª
 270   4            }
 271   3            while (hw_nb != 1)
 272   3              ; //µÈ´ıÊÍ·Å
 273   3            {
 274   4              display(); //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 275   4            }
 276   3            Buzz = 1; //·äÃùÆ÷¹Ø
 277   3          }
 278   2        }
 279   1        if (k6 != 1) //£¨²é¿´£©¼ü°´ÏÂ
 280   1        {
 281   2          display();   //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±Ïû¶¶
 282   2          if (k6 != 1) //Èç¹ûÈ·¶¨°´ÏÂ
 283   2          {
 284   3            xianshi_fx++;
 285   3            if (xianshi_fx >= 3)
 286   3              xianshi_fx = 2;
 287   3            while (k6 != 1)
 288   3              ; //µÈ´ı°´¼üÊÍ·Å
 289   3            {
 290   4              display(); //µ÷ÓÃÏÔÊ¾£¬ÓÃÓÚÑÓÊ±
 291   4            }
 292   3          }
 293   2        }
 294   1      }
 295          void display(void) //ÏÔÊ¾×Ó³ÌĞò
 296          {
 297   1      
 298   1        if (xianshi_fx == 0) //Õı³£ÏÔÊ¾
 299   1        {
 300   2          buf[1] = sec_nb / 10; //µÚ1Î» ¶«Î÷ÏÔÊ¾ÃëÊ®Î»
 301   2          buf[2] = sec_nb % 10; //µÚ2Î» ¶«Î÷ÏÔÊ¾Ãë¸öÎ»
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 6   

 302   2          buf[3] = sec_dx / 10; //µÚ3Î» ÄÏ±±ÏÔÊ¾ÃëÊ®Î»
 303   2          buf[0] = sec_dx % 10; //µÚ4Î» ÄÏ±±ÏÔÊ¾Ãë¸öÎ»
 304   2        }
 305   1        if (xianshi_fx == 1) //²é¿´Í¨ĞĞÊ±¼ä
 306   1        {
 307   2          buf[1] = set_timenb / 10; //µÚ1Î» ¶«Î÷Í¨ĞĞÃëÊ®Î»
 308   2          buf[2] = set_timenb % 10; //µÚ2Î» ¶«Î÷Í¨ĞĞÃë¸öÎ»
 309   2          buf[3] = set_timedx / 10; //µÚ3Î» ÄÏ±±Í¨ĞĞÃëÊ®Î»
 310   2          buf[0] = set_timedx % 10; //µÚ4Î» ÄÏ±±Í¨ĞĞÃë¸öÎ»
 311   2        }
 312   1      
 313   1        if (xianshi_fx == 2) //²é¿´ºìÍâ¼ÆÊıÖµ
 314   1        {
 315   2          buf[1] = num_che_nb / 10; //µÚ1Î» ¶«Î÷ºìÍâ¼ÆÊıÖµÊ®Î»
 316   2          buf[2] = num_che_nb % 10; //µÚ2Î» ¶«Î÷ºìÍâ¼ÆÊıÖµ¸öÎ»
 317   2          buf[3] = num_che_dx / 10; //µÚ3Î» ÄÏ±±ºìÍâ¼ÆÊıÖµÊ®Î»
 318   2          buf[0] = num_che_dx % 10; //µÚ4Î» ÄÏ±±ºìÍâ¼ÆÊıÖµ¸öÎ»
 319   2        }
 320   1      
 321   1        P1 = 0xff;      // ³õÊ¼µÆÎªÃğµÄ
 322   1        P0 = 0x00;      ////ÃğÏÔÊ¾
 323   1        P1 = 0xfe;      //Æ¬Ñ¡LED1
 324   1        P0 = table[buf[1]]; //ËÍ¶«Î÷Ê±¼äÊ®Î»µÄÊıÂë¹Ü±àÂë
 325   1        delay(1);     //ÑÓÊ±
 326   1        P1 = 0xff;      //¹ØÏÔÊ¾
 327   1        P0 = 0x00;      //ÃğÏÔÊ¾
 328   1      
 329   1        P1 = 0xfd;      //Æ¬Ñ¡LED2
 330   1        P0 = table[buf[2]]; //ËÍ¶«Î÷Ê±¼ä¸öÎ»µÄÊıÂë¹Ü±àÂë
 331   1        delay(1);     //ÑÓÊ±
 332   1        P1 = 0xff;      //¹ØÏÔÊ¾
 333   1        P0 = 0x00;      //¹ØÏÔÊ¾
 334   1        P1 = 0Xfb;      //Æ¬Ñ¡LED3
 335   1      
 336   1        P0 = table[buf[3]]; //ËÍÄÏ±±Ê±¼äÊ®Î»µÄÊıÂë¹Ü±àÂë
 337   1        delay(1);     //ÑÓÊ±
 338   1        P1 = 0xff;      //¹ØÏÔÊ¾
 339   1        P0 = 0x00;      //¹ØÏÔÊ¾
 340   1        P1 = 0Xf7;      //Æ¬Ñ¡LED4
 341   1        P0 = table[buf[0]]; //ËÍÄÏ±±Ê±¼ä¸öÎ»µÄÊıÂë¹Ü±àÂë
 342   1        delay(1);     //ÑÓÊ±
 343   1      }
 344          
 345          void time0(void) interrupt 1 using 1 //¶¨Ê±ÖĞ¶Ï×Ó³ÌĞò
 346          {
 347   1        TH0 = 0X3C;      //ÖØ¸³³õÖµ
 348   1        TL0 = 0XB0;      //12m¾§Õñ50ms//ÖØ¸³³õÖµ
 349   1        TR0 = 1;       //ÖØĞÂÆô¶¯¶¨Ê±Æ÷
 350   1        countt0++;       //Èí¼ş¼ÆÊı¼Ó1
 351   1        if (countt0 == 10) //¼Óµ½10Ò²¾ÍÊÇ°ëÃë
 352   1        {
 353   2          if ((sec_nb <= 5) && (dx_nb == 0) && (shanruo == 1)) //¶«Î÷»ÆµÆÉÁ
 354   2          {
 355   3            Green_dx = 0;
 356   3            Yellow_dx = 0;
 357   3            Buzz = 0; //·äÃùÆ÷¹Ø
 358   3          }
 359   2          if ((sec_dx <= 5) && (dx_nb == 1) && (shanruo == 1)) //ÄÏ±±»ÆµÆÉÁ
 360   2          {
 361   3            Green_nb = 0;
 362   3            Yellow_nb = 0;
 363   3            Buzz = 0; //·äÃùÆ÷¹Ø
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 7   

 364   3          }
 365   2        }
 366   1      
 367   1        if (countt0 == 20) // ¶¨Ê±Æ÷ÖĞ¶Ï´ÎÊı=20Ê±£¨¼´1ÃëÊ±£©
 368   1        {
 369   2          countt0 = 0; //ÇåÁã¼ÆÊıÆ÷
 370   2          sec_dx--; //¶«Î÷Ê±¼ä¼õ1
 371   2          sec_nb--; //ÄÏ±±Ê±¼ä¼õ1
 372   2      
 373   2          if ((sec_nb <= 5) && (dx_nb == 0) && (shanruo == 1)) //¶«Î÷»ÆµÆÉÁ
 374   2          {
 375   3            Green_dx = 0;
 376   3            Yellow_dx = 1;
 377   3            Buzz = 1; //·äÃùÆ÷¹Ø
 378   3          }
 379   2          if ((sec_dx <= 5) && (dx_nb == 1) && (shanruo == 1)) //ÄÏ±±»ÆµÆÉÁ
 380   2          {
 381   3            Green_nb = 0;
 382   3            Yellow_nb = 1;
 383   3            Buzz = 1; //·äÃùÆ÷¹Ø
 384   3          }
 385   2          if (sec_dx == 0 && sec_nb == 5) //µ±¶«Î÷µ¹¼ÆÊ±µ½0Ê±£¬ÖØÖÃ5Ãë£¬ÓÃÓÚ»ÆµÆÉÁË¸Ê±¼ä
 386   2          {
 387   3            sec_dx = 5;
 388   3            shanruo = 1;
 389   3          }
 390   2          if (sec_nb == 0 && sec_dx == 5) //µ±ÄÏ±±µ¹¼ÆÊ±µ½0Ê±£¬ÖØÖÃ5Ãë£¬ÓÃÓÚ»ÆµÆÉÁË¸Ê±¼ä
 391   2          {
 392   3            sec_nb = 5;
 393   3            shanruo = 1;
 394   3          }
 395   2          if (dx_nb == 0 && sec_nb == 0) //µ±»ÆµÆÉÁË¸Ê±¼äµ¹¼ÆÊ±µ½0Ê±£¬
 396   2          {
 397   3            Buzz = 1;  //·äÃùÆ÷¿ª
 398   3            P2 = 0x00; //ÖØÖÃ¶«Î÷ÄÏ±³·½ÏòµÄºìÂÌµÆ
 399   3            Green_nb = 1;
 400   3            Red_dx = 1;
 401   3            dx_nb = !dx_nb;
 402   3            shanruo = 0;
 403   3            if (num_che_nb > set_timenb / 2) //Èç¹û´ËÊ±ÄÏ±±Í¨ĞĞµÄ³µÁ¾Êı´óÓÚÔ¤ÉèÍ¨ĞĞÁ¿
 404   3              set_timenb = set_timenb + 5;
 405   3            if (num_che_nb == 0) //Èç¹ûÄÏ±±·½ÏòÎŞ³µÁ¾Í¨ĞĞ,Ã¿´Îµİ¼õ5Ãë
 406   3              set_timenb = set_timenb - 5;
 407   3            if (set_timenb <= 15)
 408   3              set_timenb = 15;
 409   3            sec_nb = set_timenb;   //ÖØ¸³ÄÏ±±·½ÏòµÄÆğÊ¼Öµ
 410   3            sec_dx = set_timenb + 5; //ÖØ¸³¶«Î÷·½ÏòµÄÆğÊ¼Öµ
 411   3            num_che_nb = 0;      //ÇåÁã
 412   3          }
 413   2      
 414   2          if (dx_nb == 1 && sec_dx == 0) //µ±»ÆµÆÉÁË¸Ê±¼äµ½
 415   2          {
 416   3            P2 = 0X00;             //ÖØÖÃ¶«Î÷ÄÏ±±µÄºìÂÌµÆ×´Ì¬
 417   3            Green_dx = 1;          //¶«Î÷ÂÌµÆÁÁ
 418   3            Red_nb = 1;            //ÄÏ±±ºìµÆÁÁ
 419   3            dx_nb = !dx_nb;          //È¡·´
 420   3            shanruo = 0;           //ÉÁË¸
 421   3            if (num_che_dx > set_timedx / 2) //Èç¹û´ËÊ±ÄÏ±±Í¨ĞĞµÄ³µÁ¾Êı´óÓÚÔ¤ÉèÍ¨ĞĞÁ¿
 422   3              set_timedx = set_timedx + 5;
 423   3            if (num_che_dx == 0) //Èç¹û¶«Î÷·½ÏòÎŞ³µÁ¾Í¨ĞĞ,Ã¿´Îµİ¼õ5Ãë
 424   3              set_timedx = set_timedx - 5;
 425   3            if (set_timedx <= 15)
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 8   

 426   3              set_timedx = 15;
 427   3            sec_dx = set_timedx;   //ÖØ¸³¶«Î÷·½ÏòµÄÆğÊ¼Öµ
 428   3            sec_nb = set_timedx + 5; //ÖØ¸³ÄÏ±±·½ÏòµÄÆğÊ¼Öµ
 429   3            num_che_dx = 0;      //ÇåÁã
 430   3          }
 431   2        }
 432   1      }
 433          void time1(void) interrupt 3 //¶¨Ê±ÖĞ¶Ï×Ó³ÌĞò
 434          {
 435   1        TH1 = 0X3C;      //ÖØ¸³³õÖµ
 436   1        TL1 = 0XB0;      //12m¾§Õñ50ms//ÖØ¸³³õÖµ
 437   1        countt1++;       //Èí¼ş¼ÆÊı¼Ó1
 438   1        if (countt1 == 10) // ¶¨Ê±Æ÷ÖĞ¶Ï´ÎÊı=10Ê±£¨¼´0.5Ãë£©
 439   1        {
 440   2          Yellow_nb = 0; //ÄÏ±±»ÆµÆÃğ
 441   2          Yellow_dx = 0; //¶«Î÷»ÆµÆÃğ
 442   2        }
 443   1        if (countt1 == 20) // ¶¨Ê±Æ÷ÖĞ¶Ï´ÎÊı=20Ê±£¨¼´1ÃëÊ±£©
 444   1        {
 445   2          countt1 = 0;   //ÇåÁã¼ÆÊıÆ÷
 446   2          Yellow_nb = 1; //ÄÏ±±»ÆµÆÁÁ
 447   2          Yellow_dx = 1; //¶«Î÷»ÆµÆÁÁ
 448   2        }
 449   1      }
 450          
 451          //Íâ²¿ÖĞ¶Ï0
 452          void int0(void) interrupt 0 using 1 
 453          {
 454   1      }
 455          
 456          //Íâ²¿ÖĞ¶Ï1
 457          void int1(void) interrupt 2 using 1 
 458          {
 459   1      }
 460          
 461          void Com_Int(void) interrupt 4    //´®¿ÚÖĞ¶Ï×Óº¯Êı
 462          {
 463   1        uchar i;
 464   1        uchar receive_data, *ruturn_data[8];
 465   1      
 466   1        EA = 0;
 467   1      
 468   1        if (RI == 1)      //µ±Ó²¼ş½ÓÊÕµ½Ò»¸öÊı¾İÊ±£¬RI»áÖÃÎ»
 469   1        {
 470   2          RI = 0;
 471   2          receive_data = SBUF;     //½ÓÊÕµ½µÄÊı¾İ
 472   2      
 473   2          if (receive_data == '1')    //Ò¹¼äÄ£Ê½
 474   2          {
 475   3            key_to1();
 476   3            display();
 477   3            ruturn_data[8] = "ok-1";
 478   3          }
 479   2          else if (receive_data == '2')   //Í£Ö¹Ä£Ê½
 480   2          {
 481   3            key_to2();
 482   3            display();
 483   3            ruturn_data[8] = "ok-2";
 484   3          }
 485   2          else if (receive_data == '3')   //È·ÈÏ£¨ÖØÏÖ£©Ä£Ê½
 486   2          {
 487   3            key_to3();
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 9   

 488   3            display();
 489   3            ruturn_data[8] = "ok-3";
 490   3          }
 491   2          else if (receive_data == '4')   //¶«Î÷Í¨ĞĞÄ£Ê½
 492   2          {
 493   3            key_to4();
 494   3            display();
 495   3            ruturn_data[8] = "ok-4";
 496   3          }
 497   2          else if (receive_data == '5')   //ÄÏ±±Í¨ĞĞÄ£Ê½
 498   2          {
 499   3            key_to5();
 500   3            display();
 501   3            ruturn_data[8] = "ok-5";
 502   3          }
 503   2          else
 504   2          {
 505   3            ruturn_data[8] = "error";   //´íÎóÃüÁî
 506   3          }
 507   2        }
 508   1        for (i = 0; i < 8; i++)
 509   1        {
 510   2          SBUF = *ruturn_data[i]; //½«Òª·¢ËÍµÄÊı¾İ·ÅÈëµ½·¢ËÍ¼Ä´æÆ÷
 511   2          while (!TI)
 512   2            ;   //µÈ´ı·¢ËÍÊı¾İÍê³É
 513   2          TI = 0; //Çå³ı·¢ËÍÍê³É±êÖ¾Î»
 514   2        }
 515   1        EA = 1;
 516   1      }
 517          void logo() //¿ª»úµÄLogo  "- - - -"
 518          {
 519   1        for (n = 0; n < 50; n++) //Ñ­»·ÏÔÊ¾----50´Î
 520   1        {
 521   2          P0 = 0x40; //ËÍĞÎ¡°-¡±
 522   2          P1 = 0xfe; //µÚÒ»Î»ÏÔÊ¾
 523   2          delay(1);  //ÑÓÊ±
 524   2          P1 = 0xfd; //µÚ¶şÎ»ÏÔÊ¾
 525   2          delay(1);  //ÑÓÊ±
 526   2          P1 = 0Xfb; //µÚÈıÎ»ÏÔÊ¾
 527   2          delay(1);  //ÑÓÊ±
 528   2          P1 = 0Xf7; //µÚËÄÎ»ÏÔÊ¾
 529   2          delay(1);  //ÑÓÊ±
 530   2          P1 = 0xff; //ÃğÏÔÊ¾
 531   2        }
 532   1      }
 533          
 534          void delay(int ms) //ÑÓÊ±×Ó³ÌĞò
 535          {
 536   1        uint j, k;
 537   1        for (j = 0; j < ms; j++) //ÑÓÊ±ms
 538   1          for (k = 0; k < 124; k++)
 539   1            ; //´óÔ¼1ºÁÃëµÄÑÓÊ±
 540   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1169    ----
   CONSTANT SIZE    =     42    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     15      25
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.54   JTD                                                                   03/10/2019 09:35:01 PAGE 10  

   BIT SIZE         =      4    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
